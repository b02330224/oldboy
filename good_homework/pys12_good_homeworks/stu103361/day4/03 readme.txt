#功能描述
#1、实现计算器的加减乘除四则运算，并且可以处理小括号优先级；
#2、计算器使用前，要求用户登录，使用用户名:jack或者tom,密码都是：123登录后，才能使用计算器；
#   如果账号锁定，请收到修改username.txt的错误登录次数为0，解锁
#   登录失败，不允许使用计算器，通过带参数的装饰器实现使用前的登录验证

#整体思路：
# 先计算不带括号的表达式，再计算带括号的表达式
# 1 乘除函数，用于处理表达式中的乘除法（去掉乘除符号），参数是列表
#   1 正则查找类似90.1*90.2  90.1*-90.2 90.1*+90.2这样两个数相乘的情况，search找出左边第一个符合要求的字符串存在mid变量
#   2 通过split将表达式分成前中后3部分，第三个参数是1
#   3 计算中间部分mid的值
#   4 将前中（mid计算后的值）后三部分重新拼接成一个新的表达式
#   5 递归调用自己，参数是新的表达式
#   6 递归退出条件，当表达式中没有乘除符号的时候，return None
# 2 加减函数，乘除处理完毕后，用加减函数处理加减法（去掉加减符号），参数是列表
#   1 正则查找类似90.1-90.2 90.1+90.2这样两个数相加减的情况，search找出左边第一个符合要求的字符串存在mid变量
#   2 通过split将表达式分成前中后3部分，第三个参数是1
#   3 计算中间部分mid的值
#   4 将前中（mid计算后的值）后三部分重新拼接成一个新的表达式
#   5 递归调用自己，参数是新的表达式
#   6 递归退出条件，当表达式中没有加减符号的时候，return None
#   7 和乘除函数不同的是，加减函数还需要替换表达式中的++ -- +- -+符号
#   8 还需要将数前面的-负号单独提取出来，---就相当于负数 ----就相当于整数
#     需要用到将待计算的表达式，作为列表的第一个元素，根据列表的第二个元素（负号每递增一次，第二个元素自增1）
#   9 计算的时候，需要先将数转换成float类型
# 3 计算函数，依次调用乘除函数和加减函数，对表达式进行运算，参数是表达式
#   1、根据符号提取的个数是奇数还是偶数，奇数就是负数，偶数就是整数
# 4 去小括号函数，上述3个函数都没有涉及到小括号，这个函数专门用来处理小括号（一层层去掉小括号），参数是表达式
#   去小括号函数，在计算小括号内的值的时候，调用计算函数
#   1 正则查找类似（-90.1*90.2+1）这样小括号开头，小括号结尾，中间不包含小括号的情况，
#     search找出左边第一个符合要求的字符串存在mid变量
#   2 通过split，用查找到的字符串作为分隔符，将表达式分成前中后3部分，第三个参数是1
#   3 计算中间部分mid的值（通过调用计算函数实现）
#   4 将前中（mid计算后的值）后三部分重新拼接成一个新的表达式
#   5 递归调用自己，参数是新的表达式
#   6 递归退出条件，当表达式中没有乘除小括号的时候，直接调用计算函数，return最后计算的值给主函数main
# 5 main函数，定义表达式，将表达式中间的空格去掉，调用去括号函数，返回去括号函数的return值
# 6 用eval函数验证最后的计算结果是否正确

#踩过的坑：
#1 "\(([\*\/\+\-]*\d+\.*\d*){2,}\)" 匹配小括号的时候，{2,}前面的小括号少了或者写成了中括号
#2 乘除法计算完毕后，递归返回的是None，如何将乘除法计算后的值，传给加减法
# （解决办法：将表达式作为列表的第一个元素传入,通过2个return将乘除计算的结果返回，传给加减法）
#3 71 113 124行，通过列表的第一个元素，将乘除后的表达式传递给加减，将加减后的字符串传递给计算函数的return值
    #关键点，这里如果不用列表的形式，直接表达式的话，会出现 ValueError: could not convert string to float:
    #如果是字典的第一个元素的话，前面的乘除法，修改了字典的第一个元素的值，变成了只含有加减号的表达式，在加减法函数，
    #接受的就是指含有加减号的，计算完毕后，字典的第一个元素的值变成了一个字符串，转换成float后，就正确了

#涉及的知识点
#1正则
#  1匹配小括号开头，小括号结尾，直接不包含小括号，只包含运算符和数字
#  2 search匹配90.1*90.2  90.1*-90.2两个数相乘除
#    split用匹配到的字符串，拆分表达式成前中后3部分
#    计算中间mid的值
#    重新拼接成新的表达式
#    递归调用函数自己，参数是新的表达式
#  3匹配90.1+90.2  90.1-90.2两个数相加减
#  4匹配计算表达式不能有大小写字母或者特殊字符
#2递归
# 1小括号递归，递归退出的条件是，没有小括号符号，直接调用计算函数，return计算函数的返回值
# 2乘除递归，递归退出的条件是，没有乘除符号，return None
# 3加减递归，递归退出的条件是，没有加减符号，return None
#3特殊处理
# 1 ++ -- +- -+都成立成单符号 in replace
# 2表达式中的空格去掉 sub
# 3提取数最前面的负号  ---就是负数  ----就是正数 divmod
# 4去掉mid两端的小括号，切片
#4带参数的装饰器，实现计算器使用前的登录验证